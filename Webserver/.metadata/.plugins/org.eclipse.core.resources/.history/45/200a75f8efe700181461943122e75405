package db.psql.connection;

public class User {
	
	static String psqlUser = "server_Adrenaline";
	static String psqlPassword = "pw";

	public static int writeIntoDBgetID(Integer ref_FF_Gew_ID, String ansprechpartner_int, String datum, String erfasser,
			String bestellnummer, String psp, String av_ve, String av_ff, String von, String bis, Boolean besetzt,
			String arbeiten, String ort, String bemerkungen, String kurztitel, String kontraktnummer, String begeher)
			throws SQLException, ClassNotFoundException, InterruptedException, ParseException {

		String url = "jdbc:sqlserver://TIMEBURNER-PC;databaseName=FFM_mob";
		Class.forName("org.postgresql.Driver");

		Connection conn = DriverManager.getConnection(url, psqlUser, psqlPassword);

		String query = "INSERT INTO ST_Vorgaenge ([ref_FF_Gew_ID] ,[Ansprechpartner_int] ,[Datum] ,[Erfasser] ,[Bestellnummer] ,[PSP] ,[AV_VE] ,[AV_FF] ,[Zeitraum_von] ,[Zeitraum_bis] ,[Baustellebesetzt] ,[Arbeiten] ,[Ort] ,[Bemerkungen]"
				+ ",[Kurztitel] ,[Kontraktnummer] ,[Begeher]) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";

		String generatedColumns[] = { "Vorgang_ID" };
		PreparedStatement preparedStmt = conn.prepareStatement(query, generatedColumns);
		preparedStmt.setInt(1, ref_FF_Gew_ID);
		preparedStmt.setString(2, ansprechpartner_int);

		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-mm-dd");
		java.util.Date date = sdf.parse(datum);
		java.sql.Date sqlDate = new Date(date.getTime());
		preparedStmt.setDate(3, sqlDate);

		preparedStmt.setString(4, erfasser);
		preparedStmt.setString(5, bestellnummer);
		preparedStmt.setString(6, psp);
		preparedStmt.setString(7, av_ve);
		preparedStmt.setString(8, av_ff);

		java.util.Date vonDate = sdf.parse(von);
		java.sql.Date sqlVon = new Date(vonDate.getTime());
		preparedStmt.setDate(9, sqlVon);

		java.util.Date bisDate = sdf.parse(bis);
		java.sql.Date sqlBis = new Date(bisDate.getTime());
		preparedStmt.setDate(10, sqlBis);
		preparedStmt.setBoolean(11, besetzt);
		preparedStmt.setString(12, arbeiten);
		preparedStmt.setString(13, ort);
		preparedStmt.setString(14, bemerkungen);
		preparedStmt.setString(15, kurztitel);
		preparedStmt.setString(16, kontraktnummer);
		preparedStmt.setString(17, begeher);

		preparedStmt.executeUpdate();

		ResultSet rs = preparedStmt.getGeneratedKeys();
		rs.next();
		int vorgangID = (int) rs.getLong(1);

		System.out.println("...process " + vorgangID + " is registered.");
		return vorgangID;
	}
	
}
